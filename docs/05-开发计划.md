# 开发计划

## 模块现状

| 模块 | 状态 | 完成内容 |
|-----|------|---------|
| **file-srv-core** | ⏳ 进行中 | DDD 分层结构、Controller 骨架、Service 接口、StorageAdapter 接口定义 |
| **file-srv-common** | ✅ 完成 | 常量、异常体系、Result 包装、TaskContext |
| **file-srv-adapters/hcs** | ✅ 完成 | HcsObsAdapter 完整实现（含分片）、自动配置 |
| **file-srv-aspect** | ⏳ 待开始 | 模块框架已建立 |
| **file-srv-autoconfiguration** | ⏳ 进行中 | 基础配置类 |
| **file-srv-plugins** | ✅ 完成 | SharedPlugin 接口、示例插件 |
| **file-srv-test** | ⏳ 待开始 | Bootstrap 启动类 |

## 迭代计划

### 迭代1：核心链路打通 ⏳

**目标**：打通同步上传/下载完整链路

| 任务 | 状态 | 说明 |
|-----|------|------|
| StorageAdapter 接口定义 | ✅ | 9 个核心方法 |
| HcsObsAdapter 实现 | ✅ | 同步上传/下载/删除/exists/预签名 |
| HcsObsAdapter 分片实现 | ✅ | initiate/uploadPart/complete/abort |
| FileService 实现 | ⏳ | 待补充业务逻辑 |
| FileController 完善 | ⏳ | 方法体待实现 |
| FileEntity + Repository | ⏳ | JPA 实体待定义 |
| MetaService 基础实现 | ⏳ | save/get/delete |
| 集成测试（MinIO） | ⏳ | Testcontainer 搭建 |

详见：[features/iteration-1.md](./features/iteration-1.md)

### 迭代2：分片上传与插件

**目标**：完成分片上传全链路，插件执行框架

| 任务 | 状态 | 说明 |
|-----|------|------|
| TaskController 完善 | ⏳ | 方法体待实现 |
| TaskService 实现 | ⏳ | 任务生命周期管理 |
| UploadTaskEntity | ⏳ | JPA 实体定义 |
| Redis 任务缓存 | ⏳ | 状态缓存、断点恢复 |
| 插件执行器 | ⏳ | 顺序调用 SharedPlugin |
| 幂等与异常处理 | ⏳ | 分片重复、合并失败处理 |

详见：[features/iteration-2.md](./features/iteration-2.md)

### 迭代3：元数据与查询优化

**目标**：完善查询能力，落实缓存策略

| 任务 | 状态 | 说明 |
|-----|------|------|
| MetaService 查询 | ⏳ | 多条件筛选、分页 |
| Caffeine + Redis 双层缓存 | ⏳ | 缓存策略与失效 |
| 查询接口分页 | ⏳ | Spring Data 分页 |
| 缓存指标埋点 | ⏳ | 命中率监控 |

详见：[features/iteration-3.md](./features/iteration-3.md)

### 迭代4：可观测性与健壮性

**目标**：监控、健康检查、性能调优

| 任务 | 状态 | 说明 |
|-----|------|------|
| Actuator 健康检查 | ⏳ | 存储、DB、Redis 探测 |
| Micrometer 指标 | ⏳ | 上传耗时、缓存命中率 |
| 压测与调优 | ⏳ | 并发分片、大文件 |
| 错误码体系完善 | ⏳ | 统一错误码定义 |

### 迭代5：切面与扩展

**目标**：切面模块、多适配器支持

| 任务 | 状态 | 说明 |
|-----|------|------|
| aspect 模块实现 | ⏳ | 可见性、审计切面 |
| S3 适配器 | ⏳ | AWS S3 / MinIO |
| 文档完善 | ⏳ | 运维手册、配置说明 |

## 里程碑

| 里程碑 | 目标 | 迭代 |
|-------|------|------|
| **M1** | 同步上传/下载可用，HcsObsAdapter 完成 | 迭代1 |
| **M2** | 分片上传全链路 + 插件框架 | 迭代2 |
| **M3** | 查询优化、缓存、可观测性 | 迭代3-4 |
| **M4** | 多适配器支持、生产就绪 | 迭代5 |

## 依赖与风险

| 风险 | 影响 | 缓解措施 |
|-----|------|---------|
| 存储 SDK 差异 | 适配器实现复杂度 | 抽象公共行为到基类 |
| 大文件/高并发 | 内存、超时问题 | 流式处理、分片并发控制 |
| 插件执行失败 | 上传完成但后处理失败 | 重试策略、告警通知 |
| 缓存一致性 | 脏读 | Cache Aside 模式、主动失效 |

## 技术债务

- [ ] StorageAdapter 接口方法尚未同步到 core 模块（当前为空接口）
- [ ] Controller 方法体待实现（目前只有签名）
- [ ] 缺少单元测试覆盖
- [ ] README.md 需要与当前结构同步
